<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆèªé…å°ç¿»ç¿»æ¨‚</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Google Font (cwTeXKai-Ext) -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=cwTeXKai+Ext&display=swap" rel="stylesheet"> -->

    <style>
        /* * è¼‰å…¥æ‚¨è‡ªå·±çš„æœ¬åœ°å­—é«”
         * 1. è«‹ç¢ºä¿æ‚¨çš„å­—é«”æª”æ¡ˆ (ä¾‹å¦‚ YourFont.ttf æˆ– YourFont.woff2) 
         * èˆ‡é€™å€‹ html æª”æ¡ˆæ”¾åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ã€‚
         * 2. è«‹å°‡ä¸‹é¢çš„ 'YourFont.ttf' æ›æˆæ‚¨å­—é«”çš„æ­£ç¢ºæª”æ¡ˆåç¨±ã€‚
         */
        @font-face {
            font-family: 'MyCustomFont'; /* æ‚¨å¯ä»¥è‡ªå·±å¹«å­—é«”å–ä¸€å€‹åç¨± */
            src: url('YourFont.ttf'); /* * ï¼ï¼ï¼è«‹æ³¨æ„ï¼ï¼ï¼
                                      * è«‹å°‡ 'YourFont.ttf' æ›¿æ›æˆæ‚¨çš„å­—é«”æª”æ¡ˆå¯¦éš›åç¨±
                                      */
            /* * å¦‚æœæ‚¨æœ‰ä¸åŒæ ¼å¼çš„å­—é«”, å¯ä»¥åƒé€™æ¨£åŠ å…¥:
             * src: url('YourFont.woff2') format('woff2'),
             * url('YourFont.ttf') format('truetype');
             */
        }

        /* * è¨­ç½®å¡ç‰‡ç¿»è½‰çš„åŸºæœ¬æ¨£å¼
         * åƒè€ƒäº† Tailwind CSS å®˜æ–¹ç¯„ä¾‹ä¾†å¯¦ç¾ 3D ç¿»è½‰æ•ˆæœ
         */

        /* å®¹å™¨ä¾†è¨­ç½® 3D é€è¦–æ•ˆæœ */
        .perspective {
            perspective: 1000px;
        }

        /* å¡ç‰‡å…§éƒ¨å®¹å™¨ï¼Œè² è²¬å¯¦éš›çš„ç¿»è½‰å‹•ç•« */
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.7s;
            transform-style: preserve-3d;
        }

        /* ç•¶å¡ç‰‡è¢«ç¿»é–‹æ™‚ (åŠ ä¸Š .is-flipped)ï¼Œæ—‹è½‰ 180 åº¦ */
        .card.is-flipped .card-inner {
            transform: rotateY(180deg);
        }

        /* å¡ç‰‡çš„æ­£é¢å’ŒèƒŒé¢ */
        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari ç€è¦½å™¨æ”¯æ´ */
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.5rem; /* p-2 */
        }

        /* å¡ç‰‡æ­£é¢ (è“‹èµ·ä¾†çš„æ¨£å­) */
        .card-front {
            background-color: #3b82f6; /* bg-blue-500 */
            color: white;
            font-size: 3rem; /* text-6xl, åŸæœ¬æ˜¯ 2.25rem */
        }

        /* å¡ç‰‡èƒŒé¢ (æˆèªæˆ–æ„æ€) */
        .card-back {
            background-color: #fef08a; /* bg-yellow-200 */
            color: #1f2937; /* text-gray-800 */
            transform: rotateY(180deg);
            font-weight: 600; /* font-semibold */
            /* èª¿æ•´å­—é«”å¤§å°ï¼Œä»¥é©æ‡‰å¤§è¢å¹• */
            font-size: 1.125rem; /* text-lg */
            line-height: 1.5rem; /* leading-snug */
        }

        /* åœ¨ sm æ–·é» (å¦‚å¹³æ¿) ä»¥ä¸Šï¼Œä½¿ç”¨æ›´å¤§çš„å­— */
        @media (min-width: 640px) {
            .card-back {
                font-size: 1.5rem; /* text-2xl */
                line-height: 2rem; /* leading-8 */
            }
        }
        
        /* å·²ç¶“é…å°æˆåŠŸçš„å¡ç‰‡ */
        .card.is-matched {
            opacity: 0.7;
            border: 4px solid #22c55e; /* border-green-500 */
            box-sizing: border-box;
        }

        /* æ‹–æ›³æ¨¡å¼æ¨£å¼ */
        .draggable-item {
            touch-action: none; /* æ”¯æ´è§¸æ§æ‹–æ›³ */
            user-select: none;
        }
        .drop-target {
            min-height: 4rem; /* ç¢ºä¿æ”¾ç½®å€æœ‰è¶³å¤ é«˜åº¦ */
        }
        .drag-over {
            /* ç•¶æœ‰æ±è¥¿æ‹–æ›³åˆ°ä¸Šæ–¹æ™‚çš„æ¨£å¼ */
            background-color: #dbeafe; /* bg-blue-100 */
            border-style: dashed;
        }
        .matched-pair {
            /* é…å°æˆåŠŸæ™‚çš„æ¨£å¼ */
            background-color: #dcfce7; /* bg-green-100 */
        }

        /* æ‡‰ç”¨æ³¨éŸ³/æ¥·æ›¸å­—é«” */
        body {
            /* * å°‡ font-family æ”¹æˆæ‚¨åœ¨ @font-face ä¸­å®šç¾©çš„åç¨±
             * å‚™ç”¨å­—é«” (serif) æœƒåœ¨è‡ªè¨‚å­—é«”è¼‰å…¥å¤±æ•—æ™‚é¡¯ç¤º
             */
            font-family: 'MyCustomFont', "cwTeXKai Ext", "cwTeXKai-Ext", "BiauKai", "DFKai-SB", "Kaiti", "Kai", serif;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center font-sans p-4">

    <div class="bg-white w-full max-w-4xl rounded-xl shadow-2xl p-6 sm:p-8">
        <h1 class="text-4xl sm:text-5xl font-bold text-center text-blue-700 mb-4">æˆèªé…å°éŠæˆ²</h1>
        
        <!-- æ¨¡å¼åˆ‡æ›æŒ‰éˆ• -->
        <div class="flex justify-center gap-4 mb-6">
            <button id="mode-memory" class="mode-btn bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold text-lg sm:text-xl shadow-md">
                ç¿»ç¿»æ¨‚
            </button>
            <button id="mode-drag" class="mode-btn bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-semibold text-lg sm:text-xl">
                æ‹–æ›³é…å°
            </button>
        </div>

        <p id="game-instructions" class="text-lg sm:text-xl text-center text-gray-600 mb-6">è«‹æ‰¾å‡ºç›¸é…çš„æˆèªå’Œæ„æ€ï¼</p>

        <!-- éŠæˆ²å€åŸŸå®¹å™¨ -->
        <div id="game-container">
            <!-- æ¨¡å¼ä¸€ï¼šç¿»ç¿»æ¨‚ -->
            <div id="memory-game-board-container">
                <div id="memory-game-board" class="grid grid-cols-4 gap-3 sm:gap-4">
                    <!-- å¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æ¨¡å¼äºŒï¼šæ‹–æ›³é…å° -->
            <div id="drag-drop-game-container" class="hidden">
                <div id="drag-drop-game-board" class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                    <!-- å·¦æ¬„ï¼šå¯æ‹–æ›³çš„æˆèª -->
                    <div id="idiom-list" class="flex flex-col gap-3">
                        <!-- æˆèªé …ç›®å°‡ç”± JS ç”Ÿæˆ -->
                    </div>
                    <!-- å³æ¬„ï¼šå¯æ”¾ç½®çš„æ„æ€ -->
                    <div id="definition-list" class="flex flex-col gap-3">
                        <!-- æ„æ€é …ç›®å°‡ç”± JS ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- é‡ç©æŒ‰éˆ• -->
        <div class="text-center mt-8">
            <button id="reset-button" class="bg-green-500 text-white px-8 py-3 rounded-lg font-semibold text-xl sm:text-2xl hover:bg-green-600 transition duration-300 shadow-md">
                é‡æ–°é–‹å§‹
            </button>
        </div>
    </div>

    <!-- éŠæˆ²å‹åˆ©å½ˆçª— -->
    <div id="win-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 sm:p-12 text-center transform scale-90 transition-transform duration-300">
            <!-- åŸæœ¬çš„ img æ¨™ç±¤ -->
            <!-- <img src="https://placehold.co/100x100/fef08a/3b82f6?text=ğŸ‰" alt="æ…¶ç¥" class="w-24 h-24 mx-auto rounded-full mb-6"> -->
            
            <!-- æ›´æ–°ï¼šä½¿ç”¨ Emoji -->
            <div class="text-7xl sm:text-8xl mb-6" role="img" aria-label="æ…¶ç¥">ğŸ‰</div>
            
            <h2 class="text-4xl sm:text-5xl font-bold text-yellow-500 mb-4">æ­å–œä½ ï¼</h2>
            <p id="win-message" class="text-xl sm:text-2xl text-gray-700 mb-8">ä½ å·²ç¶“æ‰¾å‡ºäº†æ‰€æœ‰çš„æˆèªé…å°ï¼</p>
            <button id="play-again-button" class="bg-blue-500 text-white px-8 py-4 rounded-lg font-semibold text-xl sm:text-2xl hover:bg-blue-600 transition duration-300 shadow-md">
                å†ç©ä¸€æ¬¡
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // éŠæˆ²è³‡æ–™
            const gameData = [
                { id: 1, type: 'idiom', text: 'æ¨‚æ–¼åŠ©äºº' },
                { id: 1, type: 'definition', text: 'æŠŠå¹«åŠ©åˆ¥äººç•¶ä½œå¿«æ¨‚çš„äº‹ã€‚' },
                { id: 2, type: 'idiom', text: 'ç›¡å¿ƒç›¡åŠ›' },
                { id: 2, type: 'definition', text: 'å¾ˆåŠªåŠ›ã€‚' },
                { id: 3, type: 'idiom', text: 'æ±—æµæµƒèƒŒ' }, // è¨»ï¼šæµ¹ -> æµƒ 
                { id: 3, type: 'definition', text: 'å¾ˆè¾›è‹¦ã€‚' },
                { id: 4, type: 'idiom', text: 'åŒå¿ƒå”åŠ›' },
                { id: 4, type: 'definition', text: 'å¤§å®¶ä¸€èµ·åŠªåŠ›åˆä½œã€‚' },
                { id: 5, type: 'idiom', text: 'å¿ƒèŠ±æ€’æ”¾' },
                { id: 5, type: 'definition', text: 'å¿ƒè£¡åƒé–‹èŠ±ä¸€æ¨£é–‹å¿ƒï¼' },
                { id: 6, type: 'idiom', text: 'å¿ƒæ»¿æ„è¶³' },
                { id: 6, type: 'definition', text: 'è¦ºå¾—å¾ˆæ£’ã€å¾ˆæ»¿è¶³ã€‚' },
                { id: 7, type: 'idiom', text: 'çœ‰é–‹çœ¼ç¬‘' },
                { id: 7, type: 'definition', text: 'éå¸¸æ¬£å–œæ„‰æ‚…ã€‚' },
                { id: 8, type: 'idiom', text: 'å–œå‡ºæœ›å¤–' },
                { id: 8, type: 'definition', text: 'ç™¼ç”Ÿæ²’æƒ³åˆ°çš„å¥½äº‹ï¼Œè¶…é–‹å¿ƒï¼' },
            ];

            // DOM å…ƒç´ 
            const memoryGameContainer = document.getElementById('memory-game-board-container');
            const memoryGameBoard = document.getElementById('memory-game-board');
            const dragDropGameContainer = document.getElementById('drag-drop-game-container');
            const dragDropGameBoard = document.getElementById('drag-drop-game-board');
            const idiomListContainer = document.getElementById('idiom-list');
            const definitionListContainer = document.getElementById('definition-list');

            const gameInstructions = document.getElementById('game-instructions');
            const resetButton = document.getElementById('reset-button');
            const winModal = document.getElementById('win-modal');
            const winMessage = document.getElementById('win-message');
            const playAgainButton = document.getElementById('play-again-button');
            const modeMemoryButton = document.getElementById('mode-memory');
            const modeDragButton = document.getElementById('mode-drag');

            // éŠæˆ²ç‹€æ…‹
            let currentGameMode = 'memory'; // 'memory' æˆ– 'drag'
            let matchedPairs = 0;
            const totalPairs = gameData.length / 2;

            // --- ç‹€æ…‹è®Šæ•¸ (ç¿»ç¿»æ¨‚) ---
            let flippedCards = []; 
            let canFlip = true; 

            // --- ç‹€æ…‹è®Šæ•¸ (æ‹–æ›³) ---
            let draggedItem = null; // ç›®å‰æ­£åœ¨æ‹–æ›³çš„é …ç›®
            let shuffledPairsArray = []; // å„²å­˜æ‰€æœ‰æ´—ç‰Œéçš„é…å°
            const dragBatchSize = 4; // æ¯æ‰¹é¡¯ç¤º 4 å€‹

            // --- é€šç”¨åŠŸèƒ½ ---

            // æ´—ç‰Œæ¼”ç®—æ³• (Fisher-Yates)
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // éŠæˆ²çµæŸæª¢æŸ¥
            function checkGameEnd() {
                if (matchedPairs === totalPairs) {
                    setTimeout(() => {
                        winMessage.textContent = currentGameMode === 'memory' 
                            ? 'ä½ å®Œæˆäº†ã€Œç¿»ç¿»æ¨‚ã€ï¼' 
                            : 'ä½ å®Œæˆäº†ã€Œæ‹–æ›³é…å°ã€ï¼';
                        winModal.classList.remove('hidden');
                        winModal.firstElementChild.classList.add('scale-100');
                    }, 500);
                }
            }
            
            // é‡ç½®éŠæˆ² (ä¸»å‡½æ•¸)
            function resetGame() {
                matchedPairs = 0;
                winModal.classList.add('hidden');
                winModal.firstElementChild.classList.remove('scale-100');

                if (currentGameMode === 'memory') {
                    initMemoryGame();
                } else {
                    initDragDropGame();
                }
            }

            // --- æ¨¡å¼åˆ‡æ› ---
            function switchMode(newMode) {
                if (newMode === currentGameMode) return;
                
                currentGameMode = newMode;
                if (newMode === 'memory') {
                    // åˆ‡æ›åˆ°ç¿»ç¿»æ¨‚
                    dragDropGameContainer.classList.add('hidden');
                    memoryGameContainer.classList.remove('hidden');
                    
                    modeMemoryButton.classList.add('bg-blue-500', 'text-white');
                    modeMemoryButton.classList.remove('bg-gray-300', 'text-gray-700');
                    modeDragButton.classList.add('bg-gray-300', 'text-gray-700');
                    modeDragButton.classList.remove('bg-blue-500', 'text-white');

                    gameInstructions.textContent = 'è«‹æ‰¾å‡ºç›¸é…çš„æˆèªå’Œæ„æ€ï¼';
                    resetGame();
                } else {
                    // åˆ‡æ›åˆ°æ‹–æ›³
                    memoryGameContainer.classList.add('hidden');
                    dragDropGameContainer.classList.remove('hidden');
                    
                    modeDragButton.classList.add('bg-blue-500', 'text-white');
                    modeDragButton.classList.remove('bg-gray-300', 'text-gray-700');
                    modeMemoryButton.classList.add('bg-gray-300', 'text-gray-700');
                    modeMemoryButton.classList.remove('bg-blue-500', 'text-white');

                    // gameInstructions.textContent = 'è«‹å°‡å·¦é‚Šçš„æˆèªæ‹–åˆ°å³é‚Šæ­£ç¢ºçš„æ„æ€ä¸Šã€‚'; // é€™è¡Œæœƒè¢« initDragDropGame è¦†è“‹
                    resetGame();
                }
            }

            // --- æ¨¡å¼ä¸€ï¼šç¿»ç¿»æ¨‚ (Memory Game) ---

            function initMemoryGame() {
                memoryGameBoard.innerHTML = '';
                flippedCards = [];
                canFlip = true;
                
                const shuffledCards = shuffle([...gameData]);

                shuffledCards.forEach(cardData => {
                    const cardElement = document.createElement('div');
                    cardElement.classList.add('card', 'h-24', 'sm:h-32', 'cursor-pointer', 'perspective');
                    cardElement.dataset.id = cardData.id;

                    cardElement.innerHTML = `
                        <div class="card-inner">
                            <div class="card-front">
                                <span>?</span>
                            </div>
                            <div class="card-back">
                                ${cardData.text}
                            </div>
                        </div>
                    `;

                    cardElement.addEventListener('click', () => handleCardClick(cardElement));
                    memoryGameBoard.appendChild(cardElement);
                });
            }

            function handleCardClick(clickedCard) {
                if (!canFlip || clickedCard.classList.contains('is-flipped') || clickedCard.classList.contains('is-matched')) {
                    return;
                }
                clickedCard.classList.add('is-flipped');
                flippedCards.push(clickedCard);

                if (flippedCards.length === 2) {
                    canFlip = false;
                    checkForMemoryMatch();
                }
            }

            function checkForMemoryMatch() {
                const [card1, card2] = flippedCards;
                const id1 = card1.dataset.id;
                const id2 = card2.dataset.id;

                if (id1 === id2) {
                    card1.classList.add('is-matched');
                    card2.classList.add('is-matched');
                    matchedPairs++;
                    resetFlippedCards();
                    checkGameEnd();
                } else {
                    setTimeout(() => {
                        card1.classList.remove('is-flipped');
                        card2.classList.remove('is-flipped');
                        resetFlippedCards();
                    }, 1200);
                }
            }
            
            function resetFlippedCards() {
                 flippedCards = [];
                 canFlip = true;
            }

            // --- æ¨¡å¼äºŒï¼šæ‹–æ›³é…å° (Drag & Drop) ---

            function initDragDropGame() {
                // 1. å°‡ gameData çµ„åˆç‚ºé…å°
                const pairs = [];
                const idioms = gameData.filter(item => item.type === 'idiom');
                const definitions = gameData.filter(item => item.type === 'definition');
                
                for(let idiom of idioms) {
                    pairs.push({
                        id: idiom.id,
                        idiomText: idiom.text,
                        definitionText: definitions.find(d => d.id === idiom.id).text
                    });
                }

                // 2. æ´—ç‰Œ
                shuffledPairsArray = shuffle(pairs);
                
                // 3. è¼‰å…¥ç¬¬ä¸€æ‰¹
                gameInstructions.textContent = 'è«‹å°‡å·¦é‚Šçš„æˆèªæ‹–åˆ°å³é‚Šæ­£ç¢ºçš„æ„æ€ä¸Šã€‚(1/2)';
                loadDragBatch(0);
            }

            function loadDragBatch(batchIndex) {
                idiomListContainer.innerHTML = '';
                definitionListContainer.innerHTML = '';
                
                // å–å¾—ç•¶å‰æ‰¹æ¬¡çš„é…å°
                const batchStart = batchIndex * dragBatchSize;
                const batchEnd = batchStart + dragBatchSize;
                const currentBatchPairs = shuffledPairsArray.slice(batchStart, batchEnd);

                // å¾é€™æ‰¹é…å°ä¸­æå–æˆèªå’Œæ„æ€
                const batchIdioms = currentBatchPairs.map(pair => ({ id: pair.id, text: pair.idiomText }));
                const batchDefinitions = currentBatchPairs.map(pair => ({ id: pair.id, text: pair.definitionText }));

                // *åˆ†åˆ¥*æ´—ç‰Œæˆèªå’Œæ„æ€ï¼Œé€™æ¨£æ‰éœ€è¦é…å°
                const shuffledBatchIdioms = shuffle(batchIdioms);
                const shuffledBatchDefinitions = shuffle(batchDefinitions);

                // å‰µå»º DOM
                shuffledBatchIdioms.forEach(idiom => {
                    const item = document.createElement('div');
                    item.id = `idiom-${idiom.id}`;
                    item.classList.add('draggable-item', 'bg-blue-200', 'p-4', 'rounded-lg', 'text-xl', 'sm:text-2xl', 'font-semibold', 'text-center', 'cursor-move');
                    item.textContent = idiom.text;
                    item.dataset.id = idiom.id;
                    item.setAttribute('draggable', 'true'); // è¨­ç½®ç‚ºå¯æ‹–æ›³
                    
                    // æ‹–æ›³äº‹ä»¶
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragend', handleDragEnd);

                    idiomListContainer.appendChild(item);
                });

                shuffledBatchDefinitions.forEach(def => {
                    const item = document.createElement('div');
                    item.id = `def-${def.id}`;
                    item.classList.add('drop-target', 'bg-yellow-200', 'p-4', 'rounded-lg', 'text-lg', 'sm:text-xl', 'text-gray-800', 'border-2', 'border-transparent');
                    item.textContent = def.text;
                    item.dataset.id = def.id;

                    // æ”¾ç½®äº‹ä»¶
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('dragleave', handleDragLeave);
                    item.addEventListener('drop', handleDrop);

                    definitionListContainer.appendChild(item);
                });
            }

            // æ‹–æ›³é–‹å§‹
            function handleDragStart(e) {
                draggedItem = e.target;
                // å¢åŠ ä¸€é»é€æ˜åº¦
                setTimeout(() => e.target.classList.add('opacity-50'), 0);
            }

            // æ‹–æ›³çµæŸ
            function handleDragEnd(e) {
                e.target.classList.remove('opacity-50');
                draggedItem = null;
            }

            // æ‹–æ›³åˆ°æ”¾ç½®å€ä¸Šæ–¹
            function handleDragOver(e) {
                e.preventDefault(); // å¿…é ˆï¼Œå¦å‰‡ drop äº‹ä»¶ä¸æœƒè§¸ç™¼
                // å¦‚æœæ˜¯åˆæ³•çš„æ”¾ç½®å€ (é‚„æ²’é…å°)
                if (e.target.classList.contains('drop-target') && !e.target.classList.contains('matched-pair')) {
                    e.target.classList.add('drag-over');
                }
            }

            // é›¢é–‹æ”¾ç½®å€
            function handleDragLeave(e) {
                if (e.target.classList.contains('drop-target')) {
                    e.target.classList.remove('drag-over');
                }
            }

            // æ”¾ç½®
            function handleDrop(e) {
                e.preventDefault();
                e.target.classList.remove('drag-over');
                
                if (!draggedItem) return;

                // æª¢æŸ¥æ˜¯å¦æ˜¯åˆæ³•çš„æ”¾ç½®ç›®æ¨™
                if (e.target.classList.contains('drop-target') && !e.target.classList.contains('matched-pair')) {
                    const draggedId = draggedItem.dataset.id;
                    const targetId = e.target.dataset.id;

                    if (draggedId === targetId) {
                        // é…å°æˆåŠŸï¼
                        e.target.classList.add('matched-pair'); // æ¨™è¨˜å®šç¾©
                        draggedItem.classList.add('matched-pair'); // æ¨™è¨˜æˆèª
                        
                        // è®“æˆèªä¸å¯å†æ‹–æ›³
                        draggedItem.setAttribute('draggable', 'false');
                        draggedItem.classList.remove('cursor-move');
                        draggedItem.classList.add('opacity-70');
                        
                        // è®“å®šç¾©ä¸å¯å†æ”¾ç½®
                        e.target.classList.remove('drop-target');
                        
                        // æ›´æ–°æ¨£å¼ï¼ŒæŠŠæˆèª"æ”¾é€²"å®šç¾©æ¡†
                        e.target.innerHTML = ''; // æ¸…ç©ºåŸæœ¬çš„æ„æ€
                        e.target.classList.add('flex', 'flex-col', 'items-center', 'justify-center', 'gap-2', 'p-4');
                        // ç‚ºäº†æ¨£å¼ï¼Œæˆ‘å€‘æŠŠæˆèªé …ç›®ç§»é€²ä¾†
                        draggedItem.classList.remove('bg-blue-200', 'p-4'); // ç§»é™¤èˆŠæ¨£å¼
                        draggedItem.classList.add('bg-transparent', 'text-blue-700'); // æ–°æ¨£å¼
                        
                        const definitionText = document.createElement('span');
                        // å¾ 'shuffledPairsArray' ç²å–åŸå§‹å®šç¾©æ–‡å­—
                        const originalPair = shuffledPairsArray.find(p => p.id == targetId);
                        definitionText.textContent = originalPair.definitionText;
                        definitionText.classList.add('text-lg', 'sm:text-xl');

                        e.target.appendChild(draggedItem);
                        e.target.appendChild(definitionText);

                        matchedPairs++; // å¢åŠ ç¸½é…å°æ•¸
                        
                        const currentBatch = Math.floor((matchedPairs - 1) / dragBatchSize);
                        const itemsMatchedInBatch = matchedPairs % dragBatchSize;
                        
                        // æª¢æŸ¥æ˜¯å¦å®Œæˆäº†
                        if (itemsMatchedInBatch === 0 && matchedPairs < totalPairs) {
                            // é€™æ˜¯æ‰¹æ¬¡çš„æœ€å¾Œä¸€å€‹ï¼Œä½†é‚„æ²’çµæŸéŠæˆ²
                            const nextBatchIndex = currentBatch + 1;
                            setTimeout(() => {
                                gameInstructions.textContent = `å¤ªæ£’äº†ï¼è«‹å®Œæˆç¬¬ ${nextBatchIndex + 1} çµ„ã€‚(2/2)`;
                                loadDragBatch(nextBatchIndex);
                            }, 1000); // ç­‰å¾… 1 ç§’
                        } else if (matchedPairs === totalPairs) {
                            // éŠæˆ²å®Œæˆï¼
                            checkGameEnd(); // é¡¯ç¤ºå‹åˆ©å½ˆçª—
                        }
                        
                    } else {
                        // é…å°å¤±æ•— (å¯ä»¥åŠ å€‹æç¤ºï¼Œä¾‹å¦‚æ™ƒå‹•ï¼Œä½†ç›®å‰å…ˆä¸è™•ç†)
                    }
                }
            }


            // --- äº‹ä»¶ç›£è½å™¨ ---
            resetButton.addEventListener('click', resetGame);
            playAgainButton.addEventListener('click', resetGame);
            modeMemoryButton.addEventListener('click', () => switchMode('memory'));
            modeDragButton.addEventListener('click', () => switchMode('drag'));

            // --- éŠæˆ²é–‹å§‹ ---
            // é è¨­å•Ÿå‹•ç¿»ç¿»æ¨‚
            switchMode('memory');
            // resetGame(); // ç§»é™¤é€™è¡Œï¼Œå› ç‚º switchMode å·²ç¶“æœƒå‘¼å« resetGame
        });
    </script>
</body>
</html>
